proj_path <- here::here()
proj_path
proj_path <- here::here()
source(paste0(proj_path, "R/data.R"))
proj_path <- here::here()
source(paste0(proj_path, "/R/data.R"))
data <- load_data(
repeated_tables,
repeated_key,
single_tpt_tables,
single_tpt_key,
timepoint_map,
sex_map
)
proj_path
data_path
View(repeated_tables)
repeated_tables[["mr_y_smri__vol__aseg"]]
proj_path <- here::here()
source(paste0(proj_path, "/R/data.R"))
data <- load_data(
repeated_tables,
repeated_key,
single_tpt_tables,
single_tpt_key,
timepoint_map,
sex_map
)
proj_path <- here::here()
source(paste0(proj_path, "/R/data.R"))
data <- load_data(
repeated_tables,
repeated_key,
single_tpt_tables,
single_tpt_key,
timepoint_map,
sex_map
)
proj_path <- here::here()
source(paste0(proj_path, "/R/data.R"))
data <- load_data(
repeated_tables,
repeated_key,
single_tpt_tables,
single_tpt_key,
timepoint_map,
sex_map
)
data$df %>%
arrow::write_parquet(paste0(processed_path, "full_dataset.parquet"))
data$subset %>%
arrow::write_parquet(paste0(processed_path, "processed_tabular.parquet"))
data$subset %>%
write.csv(paste0(processed_path, "processed_tabular.csv"))
library(dplyr)
library(tidyr)
library(ggplot2)
# generate an age sequence from 10 to 25
age_seq <- seq(10, 25, by = 0.5)
# simulate the out-of-sync system development
# using plogis to create distinct s-curves for maturation
brain_dev_model <- tibble(
age = age_seq,
emotion_system = plogis(age_seq, location = 13, scale = 1.5),
control_system = plogis(age_seq, location = 18, scale = 2)
)
# calculate the vulnerability gap
gap_data <- brain_dev_model %>%
mutate(vulnerability_gap = emotion_system - control_system)
# reshape for plotting
plot_data <- brain_dev_model %>%
pivot_longer(
cols = c(emotion_system, control_system),
names_to = "system_type",
values_to = "maturation_level"
)
# plot the system update timeline
ggplot() +
# highlight the out-of-sync vulnerability window
geom_ribbon(
data = gap_data,
aes(x = age, ymin = control_system, ymax = emotion_system),
fill = "#d8b4e2", alpha = 0.4
) +
# plot the two developing systems
geom_line(
data = plot_data,
aes(x = age, y = maturation_level, color = system_type),
linewidth = 1.2
) +
scale_color_manual(
values = c("emotion_system" = "#e74c3c", "control_system" = "#2980b9")
) +
theme_minimal() +
labs(
title = "adolescence: the system update mismatch",
subtitle = "the shaded area represents the temporary vulnerability gap",
x = "age (years)",
y = "maturation level",
color = "brain system"
) +
theme(
plot.title = element_text(face = "bold"),
legend.position = "bottom"
)
library(dplyr)
library(tidyr)
library(ggplot2)
# generate age sequence
age_seq <- seq(10, 25, by = 0.5)
# create a helper function to generate system development based on timing
generate_model <- function(timing_label, emotion_loc) {
tibble(
age = age_seq,
# set factors to enforce the left-to-right plot order
pubertal_timing = factor(timing_label, levels = c("early", "on-time", "late")),
# emotion system shifts based on pubertal timing
emotion_system = plogis(age_seq, location = emotion_loc, scale = 1.5),
# control system matures at a relatively consistent, later pace
control_system = plogis(age_seq, location = 18, scale = 2)
)
}
# simulate the three scenarios
# early puberty shifts emotion system earlier (left)
early_data <- generate_model("early", 11)
# on-time puberty acts as the baseline
on_time_data <- generate_model("on-time", 13)
# late puberty shifts emotion system later (right)
late_data <- generate_model("late", 15)
# combine datasets into one dataframe
all_models <- bind_rows(early_data, on_time_data, late_data)
# calculate the vulnerability gap for shading
gap_data <- all_models %>%
mutate(vulnerability_gap = emotion_system - control_system)
# reshape data into a long format for ggplot lines using tidyr
plot_data <- all_models %>%
pivot_longer(
cols = c(emotion_system, control_system),
names_to = "system_type",
values_to = "maturation_level"
)
# plot the faceted visualization
ggplot() +
# plot the shaded area first so lines sit on top
geom_ribbon(
data = gap_data,
aes(x = age, ymin = control_system, ymax = emotion_system),
fill = "#d8b4e2", alpha = 0.4
) +
# plot the developing systems
geom_line(
data = plot_data,
aes(x = age, y = maturation_level, color = system_type),
linewidth = 1.2
) +
# use facet_wrap to create the small multiples layout
facet_wrap(~ pubertal_timing) +
# styling and labels
scale_color_manual(
values = c("emotion_system" = "#e74c3c", "control_system" = "#2980b9"),
labels = c("control system", "emotion system")
) +
theme_minimal() +
labs(
title = "pubertal timing and the neurodevelopmental mismatch",
subtitle = "shifting the timing of puberty alters the width and onset of the vulnerability gap",
x = "age (years)",
y = "maturation level",
color = "brain system"
) +
theme(
plot.title = element_text(face = "bold"),
legend.position = "bottom",
strip.text = element_text(face = "bold", size = 12),
panel.spacing = unit(1.5, "lines")
)
proj_path <- here::here()
source(paste0(proj_path, "/R/data.R"))
data <- load_data(
repeated_tables,
repeated_key,
single_tpt_tables,
single_tpt_key,
timepoint_map,
sex_map
)
data$df %>%
arrow::write_parquet(paste0(processed_path, "full_dataset.parquet"))
data$subset %>%
arrow::write_parquet(paste0(processed_path, "processed_tabular.parquet"))
data$subset %>%
write.csv(paste0(processed_path, "processed_tabular.csv"))
proj_root <- here::here()
source(paste0(proj_root, "R/combat.R"))
proj_root <- here::here()
source(paste0(proj_root, "/R/combat.R"))
set.seed(42)
included_data <- load_subcortical_data(paste0(processed_path, "processed_tabular.parquet"))
harmonized <- harmonize_site(included_data)
